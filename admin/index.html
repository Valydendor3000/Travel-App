<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TripStack Admin</title>
<style>
  :root { --p:#0ea5e9; --pd:#0284c7; --b:#0f172a; --m:#64748b; --bd:#e2e8f0; --bg:#f8fafc; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--b); }
  header { background:var(--p); color:#fff; padding:16px; }
  h1 { margin:0; font-size:20px; }
  main { padding:16px; display:grid; gap:16px; grid-template-columns: repeat(auto-fit,minmax(340px,1fr)); }
  .card { background:#fff; border:1px solid var(--bd); border-radius:14px; padding:16px; }
  h2 { margin:0 0 8px; font-size:18px; }
  label { display:block; font-size:12px; color:var(--m); margin-top:10px; }
  input, select, textarea {
    width:100%; padding:10px; border:1px solid var(--bd); border-radius:10px; font-size:14px; background:#fff;
  }
  textarea { min-height:90px; }
  button { margin-top:12px; background:var(--p); color:#fff; border:none; padding:10px 14px; font-weight:700; border-radius:10px; cursor:pointer; }
  button:active { background:var(--pd); }
  .row { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  .muted { color:var(--m); font-size:12px; }
  .ok { color:#047857; font-weight:700; }
  .err { color:#b91c1c; font-weight:700; }
  .tag { display:inline-block; background:#e0f2fe; color:#0369a1; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:700; }
  .list { margin-top:8px; display:grid; gap:8px; max-height:280px; overflow:auto; }
  .item { border:1px solid var(--bd); border-radius:12px; padding:10px; background:#fff; display:flex; align-items:center; justify-content:space-between; gap:8px; }
  .item h3 { margin:0; font-size:14px; }
  .pill { font-size:11px; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; }
  .danger { background:#ef4444; }
  .danger:active { background:#dc2626; }
</style>
</head>
<body>
  <header>
    <h1>TripStack Admin</h1>
  </header>

  <main>
    <!-- Trip Management -->
    <section class="card">
      <h2>Trips</h2>
      <label>Trip Title</label>
      <input id="tripTitle" placeholder="e.g. Caribbean Cruise Adventure" />

      <label>Start Date</label>
      <input id="tripStart" type="date" />

      <label>End Date</label>
      <input id="tripEnd" type="date" />

      <div class="row">
        <label><input type="checkbox" id="tripCruise" /> Cruise</label>
        <label><input type="checkbox" id="tripFlights" /> Flights</label>
        <label><input type="checkbox" id="tripHotel" /> Hotel</label>
        <label><input type="checkbox" id="tripAllInclusive" /> All-inclusive</label>
      </div>

      <label>Notes</label>
      <textarea id="tripNotes" placeholder="Additional trip info..."></textarea>

      <div class="row">
        <label><input type="checkbox" id="tripPublic" /> Public</label>
        <label><input type="checkbox" id="tripPrivate" /> Private</label>
      </div>

      <button onclick="createTrip()">Create Trip</button>
      <div id="tripStatus" class="muted"></div>
      <div id="tripList" class="list"></div>
    </section>

    <!-- Payment Links -->
    <section class="card">
      <h2>Payment Links</h2>
      <label>Label</label>
      <input id="payLabel" placeholder="e.g. Deposit • Per Person" />
      <label>Vendor URL</label>
      <input id="payVendor" placeholder="https://vendor.com/payment" />
      <label>Due Date</label>
      <input id="payDue" type="date" />
      <button onclick="createPayment()">Add Payment Link</button>
      <div id="payStatus" class="muted"></div>
      <div id="payList" class="list"></div>
    </section>
  </main>

  <script>
    const API = "https://travel-app.thebusinessshapeup.workers.dev";
    const ADMIN_TOKEN = "YOUR_ADMIN_TOKEN_HERE"; // ← replace with your real admin token
    const GROUP_ID = "g1";

    async function createTrip() {
      const body = {
        group_id: GROUP_ID,
        title: tripTitle.value.trim(),
        start_date: Math.floor(new Date(tripStart.value).getTime() / 1000),
        end_date: Math.floor(new Date(tripEnd.value).getTime() / 1000),
        has_cruise: tripCruise.checked,
        has_flights: tripFlights.checked,
        has_hotel: tripHotel.checked,
        has_all_inclusive: tripAllInclusive.checked,
        is_public: tripPublic.checked,
        notes: tripNotes.value.trim(),
      };
      const res = await fetch(`${API}/api/trips`, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${ADMIN_TOKEN}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });
      const j = await res.json();
      tripStatus.textContent = j.ok ? "✅ Trip created" : `❌ ${j.error}`;
      loadTrips();
    }

    async function loadTrips() {
      const res = await fetch(`${API}/api/trips?groupId=${GROUP_ID}`);
      const trips = await res.json();
      tripList.innerHTML = trips.map(t => `
        <div class="item">
          <h3>${t.title}</h3>
          <span class="pill">${t.is_public ? "Public" : "Private"}</span>
        </div>
      `).join("");
    }

    async function createPayment() {
      const body = {
        label: payLabel.value.trim(),
        vendor_url: payVendor.value.trim(),
        due_at: Math.floor(new Date(payDue.value).getTime() / 1000)
      };
      const res = await fetch(`${API}/api/groups/${GROUP_ID}/payments`, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${ADMIN_TOKEN}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });
      const j = await res.json();
      payStatus.textContent = j.ok ? "✅ Payment link added" : `❌ ${j.error}`;
      loadPayments();
    }

    async function loadPayments() {
      const res = await fetch(`${API}/api/groups/${GROUP_ID}/payments`);
      const payments = await res.json();
      payList.innerHTML = payments.map(p => `
        <div class="item">
          <h3>${p.label}</h3>
          <a href="${p.vendor_url}" target="_blank" class="pill">Open</a>
        </div>
      `).join("");
    }

    loadTrips();
    loadPayments();
  </script>
</body>
</html>
